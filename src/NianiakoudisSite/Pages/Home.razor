@page "/"
@inject IPageContentService ContentService
@inject IJSRuntime JSRuntime
@implements IDisposable

<div class="home-stack" id="home-stack">
    <PageHero Content="ContentService.GetHome()" />

    <div class="home-row">
        <div class="home-content">
            <h2>Lorem ipsum dolor</h2>
            <p>
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras placerat
                vehicula felis, sed pretium dolor finibus vitae.
            </p>
            <a class="info-button" href="/info-1">Μάθετε περισσότερα</a>
        </div>
        <div class="home-visual">
            <img src="https://via.placeholder.com/480x320" alt="Placeholder 1" />
        </div>
    </div>

    <div class="home-row reverse">
        <div class="home-visual">
            <img src="https://via.placeholder.com/480x320" alt="Placeholder 2" />
        </div>
        <div class="home-content">
            <h2>Dolor sit amet</h2>
            <p>
                Integer hendrerit, justo ac suscipit posuere, orci lectus fermentum
                ligula, at pretium lorem felis vitae massa.
            </p>
            <a class="info-button" href="/info-2">Μάθετε περισσότερα</a>
        </div>
    </div>

    <div class="home-row">
        <div class="home-content">
            <h2>Consectetur adipiscing</h2>
            <p>
                Nulla facilisi. Vivamus id magna eu velit bibendum dictum sed sed
                lectus.
            </p>
            <a class="info-button" href="/info-3">Μάθετε περισσότερα</a>
        </div>
        <div class="home-visual">
            <img src="https://via.placeholder.com/480x320" alt="Placeholder 3" />
        </div>
    </div>

    <div class="home-row reverse">
        <div class="home-visual">
            <img src="https://via.placeholder.com/480x320" alt="Placeholder 4" />
        </div>
        <div class="home-content">
            <h2>Elit sed do</h2>
            <p>
                Curabitur faucibus nulla et nibh vehicula, nec convallis mauris
                vulputate.
            </p>
            <a class="info-button" href="/info-4">Μάθετε περισσότερα</a>
        </div>
    </div>
</div>

<button class="scroll-top-button" @onclick="ScrollToTop" id="scroll-top-button">
    Πίσω στην κορυφή
</button>

@code {
    private DotNetObjectReference<Home>? _objRef;
    private IJSObjectReference? _jsModule;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            _objRef = DotNetObjectReference.Create(this);
            _jsModule = await JSRuntime.InvokeAsync<IJSObjectReference>("import", "./js/scrollObserver.js");
            await _jsModule.InvokeVoidAsync("observeLastRow", _objRef);
        }
    }

    [JSInvokable]
    public void ShowScrollButton()
    {
        // This will be called from JavaScript when the last row becomes visible
        var button = (Microsoft.AspNetCore.Components.ElementReference)default;
        // We'll handle this via CSS class toggle in JavaScript
    }

    private async Task ScrollToTop()
    {
        await JSRuntime.InvokeVoidAsync("eval", "window.scrollTo({ top: 0, behavior: 'smooth' })");
    }

    public void Dispose()
    {
        _objRef?.Dispose();
        _jsModule?.DisposeAsync();
    }
}
